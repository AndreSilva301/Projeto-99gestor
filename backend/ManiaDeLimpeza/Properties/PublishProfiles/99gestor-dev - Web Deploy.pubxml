<?xml version="1.0" encoding="utf-8"?>
<!--
Esse arquivo é usado pelo processo de publicação/pacote do seu projeto Web. É possível personalizar o comportamento deste processo
ao editar este arquivo MSBuild. Para saber mais sobre isso, visite https://go.microsoft.com/fwlink/?LinkID=208121. 
-->
<Project>
  <PropertyGroup>
    <WebPublishMethod>MSDeploy</WebPublishMethod>
    <LastUsedBuildConfiguration>Release</LastUsedBuildConfiguration>
    <LastUsedPlatform>Any CPU</LastUsedPlatform>
    <SiteUrlToLaunchAfterPublish>http://welberreis-001-site1.site4future.com/</SiteUrlToLaunchAfterPublish>
    <LaunchSiteAfterPublish>true</LaunchSiteAfterPublish>
    <ExcludeApp_Data>false</ExcludeApp_Data>
    <ProjectGuid>14bb407e-4dc9-4024-9d97-a66eccf0e9bf</ProjectGuid>
    <MSDeployServiceURL>https://win1015.site4now.net:8172/msdeploy.axd?site=welberreis-001-site1</MSDeployServiceURL>
    <DeployIisAppPath>welberreis-001-site1</DeployIisAppPath>
    <RemoteSitePhysicalPath />
    <SkipExtraFilesOnServer>true</SkipExtraFilesOnServer>
    <MSDeployPublishMethod>WMSVC</MSDeployPublishMethod>
    <EnableMSDeployBackup>true</EnableMSDeployBackup>
    <EnableMsDeployAppOffline>true</EnableMsDeployAppOffline>
    <UserName>welberreis-001</UserName>
    <_SavePWD>false</_SavePWD>
    <EnvironmentName>Development</EnvironmentName>
  </PropertyGroup>
  
  <!-- Build and copy frontend before publishing -->
  <Target Name="BuildFrontend" BeforeTargets="PrepareForPublish;ComputeFilesToPublish">
    <Message Text="========================================" Importance="high" />
    <Message Text="Cleaning wwwroot directory..." Importance="high" />
    <Message Text="========================================" Importance="high" />
    
    <!-- Clean wwwroot directory first using PowerShell to force delete -->
    <Exec Command="powershell -Command &quot;if (Test-Path '$(ProjectDir)wwwroot') { Remove-Item -Path '$(ProjectDir)wwwroot' -Recurse -Force -ErrorAction SilentlyContinue }&quot;" 
          IgnoreExitCode="true" />
    <MakeDir Directories="$(ProjectDir)wwwroot" Condition="!Exists('$(ProjectDir)wwwroot')" />
    
    <Message Text="========================================" Importance="high" />
    <Message Text="Building React frontend..." Importance="high" />
    <Message Text="========================================" Importance="high" />
    
    <!-- Install npm dependencies -->
    <Exec Command="cd $(ProjectDir)..\..\frontend &amp;&amp; npm install" />
    
    <!-- Build frontend with development environment -->
    <Exec Command="cd $(ProjectDir)..\..\frontend &amp;&amp; npm run build:dev" />
    
    <!-- Create wwwroot if it doesn't exist -->
    <MakeDir Directories="$(ProjectDir)wwwroot" Condition="!Exists('$(ProjectDir)wwwroot')" />
    
    <!-- Copy frontend build files to wwwroot -->
    <Message Text="========================================" Importance="high" />
    <Message Text="Copying frontend files to wwwroot..." Importance="high" />
    <Message Text="========================================" Importance="high" />
    <ItemGroup>
      <FrontendFiles Include="$(ProjectDir)..\..\frontend\build\**\*.*" />
    </ItemGroup>
    <Copy SourceFiles="@(FrontendFiles)" 
          DestinationFiles="@(FrontendFiles->'$(ProjectDir)wwwroot\%(RecursiveDir)%(Filename)%(Extension)')" 
          SkipUnchangedFiles="false" />
    
    <Message Text="========================================" Importance="high" />
    <Message Text="Frontend build completed successfully!" Importance="high" />
    <Message Text="========================================" Importance="high" />
  </Target>
</Project>