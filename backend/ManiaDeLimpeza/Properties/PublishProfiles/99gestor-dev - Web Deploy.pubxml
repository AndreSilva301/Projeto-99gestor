<?xml version="1.0" encoding="utf-8"?>
<!--
Esse arquivo é usado pelo processo de publicação/pacote do seu projeto Web. É possível personalizar o comportamento deste processo
ao editar este arquivo MSBuild. Para saber mais sobre isso, visite https://go.microsoft.com/fwlink/?LinkID=208121. 
-->
<Project>
	<PropertyGroup>
		<WebPublishMethod>MSDeploy</WebPublishMethod>
		<LastUsedBuildConfiguration>Release</LastUsedBuildConfiguration>
		<LastUsedPlatform>Any CPU</LastUsedPlatform>

		<SiteUrlToLaunchAfterPublish>https://example.com/</SiteUrlToLaunchAfterPublish>
		<LaunchSiteAfterPublish>false</LaunchSiteAfterPublish>

		<ExcludeApp_Data>false</ExcludeApp_Data>

		<ProjectGuid>00000000-0000-0000-0000-000000000000</ProjectGuid>

		<MSDeployServiceURL>https://example-server:8172/MsDeploy.axd?site=example-site</MSDeployServiceURL>
		<DeployIisAppPath>example-site</DeployIisAppPath>

		<RemoteSitePhysicalPath />
		<SkipExtraFilesOnServer>true</SkipExtraFilesOnServer>
		<MSDeployPublishMethod>WMSVC</MSDeployPublishMethod>
		<EnableMSDeployBackup>true</EnableMSDeployBackup>
		<EnableMsDeployAppOffline>true</EnableMsDeployAppOffline>

		<UserName>example-user</UserName>
		<_SavePWD>false</_SavePWD>

		<EnvironmentName>Development</EnvironmentName>
	</PropertyGroup>

	<!-- Build and copy frontend before publishing -->
	<Target Name="BuildFrontend" BeforeTargets="PrepareForPublish;ComputeFilesToPublish">

		<Exec Command="powershell -Command &quot;if (Test-Path '$(ProjectDir)wwwroot') { Remove-Item -Path '$(ProjectDir)wwwroot' -Recurse -Force -ErrorAction SilentlyContinue }&quot;"
			  IgnoreExitCode="true" />

		<MakeDir Directories="$(ProjectDir)wwwroot" Condition="!Exists('$(ProjectDir)wwwroot')" />

		<!-- Install npm dependencies -->
		<Exec Command="cd $(ProjectDir)..\..\frontend &amp;&amp; npm install" />

		<!-- Build frontend -->
		<Exec Command="cd $(ProjectDir)..\..\frontend &amp;&amp; npm run build" />

		<MakeDir Directories="$(ProjectDir)wwwroot" Condition="!Exists('$(ProjectDir)wwwroot')" />

		<ItemGroup>
			<FrontendFiles Include="$(ProjectDir)..\..\frontend\build\**\*.*" />
		</ItemGroup>

		<Copy SourceFiles="@(FrontendFiles)"
			  DestinationFiles="@(FrontendFiles->'$(ProjectDir)wwwroot\%(RecursiveDir)%(Filename)%(Extension)')"
			  SkipUnchangedFiles="false" />

	</Target>
</Project>